LINK: https://leetcode.com/problems/primary-department-for-each-employee/?envType=problem-list-v2&envId=m8baczxh

==> My approach:
-- WITH CTE AS(
-- SELECT Employee_id, count(department_id) as cnt
-- FROM Employee
-- GROUP BY employee_id
-- )

-- SELECT employee_id, department_id
-- FROM Employee
-- WHERE employee_id IN (SELECT Employee_id FROM CTE WHERE cnt = 1)
-- UNION
-- SELECT employee_id, department_id
-- FROM Employee
-- WHERE primary_flag = "Y"

WITH DeptCount AS (
    SELECT employee_id
         , COUNT(DISTINCT department_id) AS dept_count
    FROM Employee
    GROUP BY employee_id
    HAVING COUNT(DISTINCT department_id) > 1
)
, PrimaryDept AS (
    SELECT e.employee_id 
         , e.department_id
    FROM Employee AS e
    LEFT JOIN DeptCount AS d  
        ON d.employee_id = e.employee_id
    WHERE e.primary_flag = 'Y' 
        OR (e.primary_flag = 'N' AND  e.employee_id NOT IN (SELECt employee_id FROM DeptCount))
)
SELECT * 
FROM PrimaryDept;
