LINK: https://leetcode.com/problems/find-golden-hour-customers/description/?envType=problem-list-v2&envId=21z3vf9h

==> my approach:
-- Filter customers with at least 3 orders + 60% of peak-hour order
WITH GoldenHourCustomer AS (
    SELECT customer_id 
         , COUNT(*) AS total_orders     
         , ROUND((COUNT(
            CASE WHEN (CAST(order_timestamp AS time) BETWEEN '11:00:00' AND '14:00:00') OR (CAST(order_timestamp AS time) BETWEEN '18:00:00' AND '21:00:00')
            THEN 1
            END)*100.0/ COUNT(*)), 0) AS peak_hour_percentage 
         , ROUND(AVG(order_rating*1.0), 2) AS average_rating  
         , COUNT(order_rating)*100.0/COUNT(*) AS rating_percentage
    FROM restaurant_orders
    GROUP BY customer_id     
)
SELECT customer_id 
     , total_orders
     , peak_hour_percentage
     , average_rating 
FROM GoldenHourCustomer
WHERE total_orders >= 3 
    AND peak_hour_percentage >= 60
    AND average_rating >= 4.0
    AND rating_percentage >= 50
ORDER BY average_rating DESC
       , customer_id DESC ;


