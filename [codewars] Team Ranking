LINK: https://www.codewars.com/kata/62bf7e378e54a4003e8c3a21/train/sql

==> My approach:
WITH mem_ranking AS (
  SELECT t.id AS team_id
       , t.name AS team_name
       , tm.id AS member_id
       , tm.name AS member_name
       , tm.score
       , DENSE_RANK() OVER (PARTITION BY tm.team_id ORDER BY tm.score DESC, tm.id ASC) AS member_ranking
FROM teams AS t
JOIN team_members as tm 
ON t.id = tm.team_id 
)
, team_ranking AS (
SELECT team_id
     , team_name
     , SUM(score) AS team_score
     , DENSE_RANK() OVER (ORDER BY SUM(score) DESC, team_id ASC) AS team_rank
     , STRING_AGG(member_name || ' (' || score || ')', ', ') AS top_members
FROM mem_ranking 
WHERE member_ranking <= 5
GROUP BY team_id
       , team_name
)
SELECT team_rank 
     , team_name
     , team_score
     , top_members
FROM team_ranking
WHERE team_rank <= 10
ORDER BY team_rank ASC;
