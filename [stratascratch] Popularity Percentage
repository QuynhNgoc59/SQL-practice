LINK: https://platform.stratascratch.com/coding/10284-popularity-percentage?code_type=5

==> My approach:
-- Re-structure table for later aggregation
WITH ReshapedTable AS (
SELECT user1
     , user2
FROM facebook_friends AS f1 
UNION ALL 
SELECT user2
     , user1
FROM facebook_friends AS f1 
)
--Get distinct users
, DistinctUser AS (
SELECT DISTINCT user1
FROM ReshapedTable
)
--Count friends per user
, FriendCount AS (
SELECT user1
     , COUNT(*) AS total_friends
FROM ReshapedTable
GROUP BY user1
)
--Calculate popularity %
SELECT user1
     , ROUND(total_friends*1.0/ (SELECT COUNT(*) FROM DistinctUser)*100, 2) AS popularity_percent
FROM FriendCount;
